{% extends 'base.back.html.twig' %}
{% block title %}Réclamations - Admin{% endblock %}
{% block admin_container_class %}reclamations-page{% endblock %}
{% block stylesheets %}
{{ parent() }}
<style>
.reclamations-page .header h1 { margin-bottom: 0.25rem; }
.reclamation-block { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 1.5rem; overflow: hidden; border: 1px solid rgba(0,0,0,0.06); }
.reclamation-block-header { display: flex; align-items: flex-start; justify-content: space-between; flex-wrap: wrap; gap: 1rem; padding: 1.25rem 1.5rem; background: #f8f6f3; border-bottom: 1px solid rgba(0,0,0,0.06); }
.reclamation-block-title { font-size: 1.125rem; font-weight: 600; color: #2d2d2d; margin: 0; }
.reclamation-block-meta { font-size: 0.875rem; color: #666; margin-top: 0.25rem; }
.reclamation-block-actions { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
.statut-badge { display: inline-block; padding: 0.35rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 500; }
.statut-en_attente { background: #fff3cd; color: #856404; }
.statut-en_cours { background: #cfe2ff; color: #084298; }
.statut-validee { background: #d1e7dd; color: #0f5132; }
.statut-rejetee { background: #f8d7da; color: #842029; }
.btn-pdf { display: inline-flex; padding: 0.6rem 1.2rem; background: #8b5e4a; color: white; border-radius: 8px; font-size: 0.9rem; text-decoration: none; }
.btn-action { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.875rem; font-weight: 500; text-decoration: none; }
.btn-view { background: #8b5e4a; color: #fff; }
.btn-repondre { background: #2d7a4f; color: #fff; }
.filters-section { background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; }
.search-box input { width: 100%; padding: 0.75rem 1rem; border: 1px solid #e0d5ca; border-radius: 8px; font-size: 0.95rem; }
.filter-group select { padding: 0.75rem 1rem; border: 1px solid #e0d5ca; border-radius: 8px; font-size: 0.95rem; background-color: white; cursor: pointer; }
.reclamation-description { padding: 1rem 1.5rem; color: #555; font-size: 0.9rem; }
.empty-reclamations { text-align: center; padding: 3rem; color: #666; background: #f8f8f8; border-radius: 12px; }
.alert { padding: 0.75rem 1rem; border-radius: 8px; margin-bottom: 1rem; }
.alert-success { background: #d4edda; color: #155724; }
.alert-error { background: #f8d7da; color: #721c24; }
</style>
{% endblock %}
{% block back_main %}
<header class="header">
    <div class="header-left"><h1>Réclamations</h1><p class="header-subtitle">Liste des réclamations</p></div>
    <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="{{ path('back_statistiques') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.2rem; background: #8b5e4a; color: white; border-radius: 8px; text-decoration: none; font-size: 0.9rem;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
            <span>Statistiques</span>
        </a>
    </div>
</header>
{% for message in app.flashes('success') %}<div class="alert alert-success">{{ message }}</div>{% endfor %}
{% for message in app.flashes('error') %}<div class="alert alert-error">{{ message }}</div>{% endfor %}
<div class="filters-section">
<form method="GET" action="{{ path('back_reclamations') }}" style="display: flex; gap: 0.5rem; flex: 1;">
<input type="text" name="recherche" value="{{ filters.recherche|default('') }}" placeholder="Rechercher...">
<input type="hidden" name="statut" value="{{ filters.statut|default('') }}">
<input type="hidden" name="tri" value="{{ filters.tri|default('date_desc') }}">
<button type="submit" style="padding: 0.6rem 1rem; background: #8b5e4a; color: white; border: none; border-radius: 8px;">Rechercher</button>
</form>
<form method="GET" action="{{ path('back_reclamations') }}" class="filter-group">
<input type="hidden" name="recherche" value="{{ filters.recherche|default('') }}">
<select name="statut" onchange="this.form.submit()">
<option value="">Tous</option>
<option value="en_attente" {% if filters.statut == 'en_attente' %}selected{% endif %}>En attente</option>
<option value="en_cours" {% if filters.statut == 'en_cours' %}selected{% endif %}>En cours</option>
<option value="validee" {% if filters.statut == 'validee' %}selected{% endif %}>Validée</option>
<option value="rejetee" {% if filters.statut == 'rejetee' %}selected{% endif %}>Rejetée</option>
</select>
<select name="tri" onchange="this.form.submit()">
<option value="date_desc" {% if filters.tri == 'date_desc' %}selected{% endif %}>Date récentes</option>
<option value="date_asc" {% if filters.tri == 'date_asc' %}selected{% endif %}>Date anciennes</option>
</select>
</form>
<a href="{{ path('back_reclamations_pdf', filters) }}" class="btn-pdf" target="_blank">Exporter PDF</a>
</div>
{% if reclamations|length > 0 %}
<div class="reclamations-list">
{% for reclamation in reclamations %}
<div class="reclamation-block">
<div class="reclamation-block-header">
<div><h2 class="reclamation-block-title">{{ reclamation.titre }}</h2>
<div class="reclamation-block-meta">{{ reclamation.user.prenom }} {{ reclamation.user.nom }} ({{ reclamation.user.role }}) · {{ reclamation.datecreation ? reclamation.datecreation|date('d/m/Y H:i') : '—' }}</div></div>
<div class="reclamation-block-actions">
<span class="statut-badge statut-{{ reclamation.statut|replace({'_': '-'}) }}">{{ reclamation.statut }}</span>
<a href="{{ path('back_reclamation_show', { id: reclamation.id }) }}" class="btn-action btn-view">Voir</a>
{% if reclamation.statut != 'validee' and reclamation.statut != 'rejetee' %}
<a href="{{ path('back_reclamation_repondre', { id: reclamation.id }) }}" class="btn-action btn-repondre">Répondre</a>
{% endif %}
</div>
</div>
{% if reclamation.descripition %}<div class="reclamation-description">{{ reclamation.descripition|nl2br }}</div>{% endif %}
</div>
{% endfor %}
</div>
{% else %}
<div class="empty-reclamations"><p>Aucune réclamation.</p></div>
{% endif %}
{% endblock %}

{% extends 'base.back.html.twig' %}

{% block title %}Statistiques Produits & Propositions - Admin{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
@keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fillProgress { from { width: 0; } }
@keyframes growBar { from { height: 0; } }
.stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-top: 1rem; }
.stat-card-large { background: #fff; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.06); animation: slideUp 0.6s ease forwards; border: 1px solid #eee; }
.chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; }
.chart-header h3 { font-size: 1.1rem; color: #1a1a1a; font-weight: 800; margin: 0; }
.progress-list { list-style: none; padding: 0; margin: 0; }
.progress-item { margin-bottom: 1rem; }
.progress-info { display: flex; justify-content: space-between; margin-bottom: 0.35rem; font-size: 0.9rem; font-weight: 700; color: #4b5563; }
.progress-bar-bg { height: 10px; background: #f1f5f9; border-radius: 20px; overflow: hidden; }
.progress-bar-fill { height: 100%; border-radius: 20px; animation: fillProgress 1.5s ease forwards; }
.bar-chart-container { display: flex; align-items: flex-end; gap: 0.75rem; height: 160px; padding: 1rem 0 0; border-bottom: 2px solid #f1f5f9; }
.bar-wrapper { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; height: 100%; justify-content: flex-end; }
.bar-fill { width: 100%; background: #8b5e4a; border-radius: 6px 6px 0 0; animation: growBar 1.2s ease forwards; }
.mat-badge { display: flex; align-items: center; gap: 0.5rem; background: #f8fafc; padding: 0.75rem; border-radius: 10px; border: 1px solid #e2e8f0; margin-bottom: 0.5rem; }
</style>
{% endblock %}

{% block back_main %}
<header class="header" style="margin-bottom:1rem;">
    <div class="header-left">
        <h1>Statistiques Produits & Propositions</h1>
        <p class="header-subtitle">Tableau de bord analytique</p>
    </div>
    <a href="{{ path('back_produit_recyclable') }}" style="color:#8b5e4a;text-decoration:none;">← Produits</a>
</header>

<div class="stats-grid">
    <div class="stat-card-large">
        <div class="chart-header">
            <h3>État du Stock Recyclable</h3>
        </div>
        <div style="display:flex;gap:1.5rem;align-items:center;">
            <div style="text-align:center;">
                <div style="font-size:2rem;font-weight:900;color:#8b5e4a;">{{ total_produits }}</div>
                <div style="font-size:0.75rem;font-weight:700;color:#94a3b8;text-transform:uppercase;">Articles</div>
            </div>
            <div style="flex:1;">
                <ul class="progress-list">
                    {% set total = total_produits > 0 ? total_produits : 1 %}
                    {% for etat, count in stats_etat %}
                        {% set percent = (count / total * 100)|round %}
                        {% set color = '#94a3b8' %}
                        {% if etat|lower == 'bon' %}{% set color = '#10b981' %}
                        {% elseif etat|lower == 'moyen' %}{% set color = '#f59e0b' %}
                        {% elseif etat|lower == 'mauvais' %}{% set color = '#ef4444' %}
                        {% endif %}
                        <li class="progress-item">
                            <div class="progress-info"><span>{{ etat }}</span><span>{{ count }}</span></div>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill" style="width:{{ percent }}%;background:{{ color }};"></div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <div class="stat-card-large">
        <div class="chart-header">
            <h3>Impact des Propositions</h3>
        </div>
        <div style="display:flex;align-items:baseline;gap:0.5rem;margin-bottom:1rem;">
            <div style="font-size:2rem;font-weight:900;color:#8b5e4a;">{{ total_propositions }}</div>
            <div style="font-size:0.9rem;font-weight:600;color:#64748b;">Soumissions</div>
        </div>
        <div class="bar-chart-container">
            {% set total_prop = total_propositions > 0 ? total_propositions : 1 %}
            {% for etat, count in stats_prop_etat %}
                {% set percent = (count / total_prop * 100)|round %}
                <div class="bar-wrapper">
                    <div class="bar-fill" style="height:{{ percent }}%;"></div>
                    <span style="font-size:10px;font-weight:700;color:#64748b;">{{ etat }}</span>
                </div>
            {% else %}
                <div style="width:100%;text-align:center;color:#94a3b8;">Aucune donnée</div>
            {% endfor %}
        </div>
    </div>

    <div class="stat-card-large" style="grid-column: span 2;">
        <div class="chart-header">
            <h3>Top Matériaux Recyclables</h3>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1rem;">
            {% set total_p = total_produits > 0 ? total_produits : 1 %}
            {% for mat, count in stats_materiau|slice(0, 6) %}
                {% set mat_percent = (count / total_p * 100)|round %}
                <div class="mat-badge">
                    <div style="flex:1;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.25rem;">
                            <span style="font-size:0.85rem;font-weight:800;color:#1e293b;">{{ mat }}</span>
                            <span style="font-size:0.9rem;font-weight:900;color:#8b5e4a;">{{ count }}</span>
                        </div>
                        <div style="height:4px;background:#f1f5f9;border-radius:4px;overflow:hidden;">
                            <div style="height:100%;width:{{ mat_percent }}%;background:#8b5e4a;border-radius:4px;"></div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div style="grid-column:1/-1;text-align:center;padding:1rem;color:#94a3b8;">Aucun matériau.</div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% extends 'admin/index.html.twig' %}

{% block title %}Utilisateurs Supprimes{% endblock %}

{% block admin_header_title %}Utilisateurs supprimes{% endblock %}
{% block admin_header_subtitle %}Corbeille des comptes utilisateurs{% endblock %}

{% block admin_main %}
<style>
    .modal-delete {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        justify-content: center;
        align-items: center;
        padding: 1rem;
    }
    .modal-delete.show { display: flex; }
    .modal-delete-content {
        width: 100%;
        max-width: 460px;
        background: #fff;
        border-radius: .75rem;
        box-shadow: 0 16px 36px rgba(0, 0, 0, 0.18);
        overflow: hidden;
    }
    .modal-delete-header {
        padding: 1rem 1.2rem;
        border-bottom: 1px solid #eee;
        font-weight: 600;
        color: #3D3229;
    }
    .modal-delete-body {
        padding: 1rem 1.2rem 1.2rem;
        color: #5C4A3D;
    }
    .modal-delete-actions {
        display: flex;
        gap: .6rem;
        justify-content: flex-end;
        margin-top: 1rem;
    }
    .btn-cancel {
        background: #e5e7eb;
        color: #111827;
        border: none;
        padding: .55rem .9rem;
        border-radius: .35rem;
        cursor: pointer;
    }
    .btn-danger {
        background: #dc2626;
        color: #fff;
        border: none;
        padding: .55rem .9rem;
        border-radius: .35rem;
        cursor: pointer;
    }
    .icon-btn {
        width: 38px;
        height: 38px;
        border-radius: 999px;
        border: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform .2s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .icon-btn:hover {
        transform: translateY(-1px) scale(1.04);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.16);
    }
    .icon-btn svg {
        width: 18px;
        height: 18px;
    }
    .icon-btn-restore {
        background: linear-gradient(135deg, #5DAA78, #3F8F60);
        color: #fff;
    }
    .icon-btn-delete {
        background: linear-gradient(135deg, #E55A5A, #C53030);
        color: #fff;
    }
</style>

<div class="users-panel">
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="flash {{ label }}">{{ message }}</div>
        {% endfor %}
    {% endfor %}

    <div class="users-toolbar">
        <div class="search-form">
            <a class="btn-secondary" href="{{ path('back_users') }}">Retour</a>
        </div>
    </div>

    {% if users is not empty %}
        <table class="users-table">
            <thead>
                <tr>
                    <th>Prenom</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Supprime le</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                    <tr>
                        <td>{{ user.prenom }}</td>
                        <td>{{ user.nom }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.role }}</td>
                        <td>{{ user.deletedAt ? user.deletedAt|date('d/m/Y H:i') : '' }}</td>
                        <td>
                            <div class="actions" style="display:flex; gap:.5rem; flex-wrap:wrap;">
                                <form method="post" action="{{ path('back_user_restore', {'id': user.id}) }}">
                                    <button class="icon-btn icon-btn-restore" type="submit" title="Restaurer" aria-label="Restaurer">
                                        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                            <path d="M3 12a9 9 0 1 0 3-6.7" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M3 4v5h5" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                </form>
                                <button
                                    type="button"
                                    class="icon-btn icon-btn-delete js-open-delete-modal"
                                    data-user-name="{{ user.prenom }} {{ user.nom }}"
                                    data-delete-url="{{ path('back_user_delete_permanent', {'id': user.id}) }}"
                                    title="Supprimer definitivement"
                                    aria-label="Supprimer definitivement">
                                    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                        <path d="M4 7h16" stroke="currentColor" stroke-width="1.9" stroke-linecap="round"/>
                                        <path d="M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" stroke="currentColor" stroke-width="1.9" stroke-linecap="round"/>
                                        <path d="M7 7l1 12a1 1 0 0 0 1 .9h6a1 1 0 0 0 1-.9l1-12" stroke="currentColor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M10 11v5M14 11v5" stroke="currentColor" stroke-width="1.9" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <h2>Aucun utilisateur supprime</h2>
            <p>La corbeille est vide.</p>
        </div>
    {% endif %}
</div>

<div id="deleteModal" class="modal-delete" aria-hidden="true">
    <div class="modal-delete-content">
        <div class="modal-delete-header">Confirmation</div>
        <div class="modal-delete-body">
            <p id="deleteModalText">Voulez-vous vraiment supprimer cet utilisateur definitivement ?</p>
            <form id="deleteModalForm" method="post">
                <div class="modal-delete-actions">
                    <button type="button" id="deleteModalCancel" class="btn-cancel">Annuler</button>
                    <button type="submit" class="btn-danger">Confirmer</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    var modal = document.getElementById('deleteModal');
    var modalForm = document.getElementById('deleteModalForm');
    var modalText = document.getElementById('deleteModalText');
    var cancelBtn = document.getElementById('deleteModalCancel');

    function closeModal() {
        modal.classList.remove('show');
        modal.setAttribute('aria-hidden', 'true');
        modalForm.removeAttribute('action');
    }

    document.querySelectorAll('.js-open-delete-modal').forEach(function (btn) {
        btn.addEventListener('click', function () {
            var userName = btn.getAttribute('data-user-name') || 'cet utilisateur';
            var url = btn.getAttribute('data-delete-url');
            modalText.textContent = 'Voulez-vous vraiment supprimer definitivement "' + userName + '" de la base ? Cette action est irreversible.';
            modalForm.setAttribute('action', url);
            modal.classList.add('show');
            modal.setAttribute('aria-hidden', 'false');
        });
    });

    cancelBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', function (e) {
        if (e.target === modal) {
            closeModal();
        }
    });
});
</script>
{% endblock %}

{% extends 'base.html.front.twig' %}

{% block title %}{{ article.titre }} - AfkArt{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background-color: #faf8f6; color: #3d3d3d; }
        .article-container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        .breadcrumb { display: flex; align-items: center; gap: 10px; margin-bottom: 30px; font-size: 14px; }
        .breadcrumb a { color: #b8956a; text-decoration: none; transition: color 0.3s; }
        .breadcrumb a:hover { color: #8b6f47; }
        .article-header { margin-bottom: 40px; }
        .article-image { width: 100%; max-height: 500px; object-fit: cover; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .article-title { font-family: 'Cormorant Garamond', serif; font-size: 48px; font-weight: 600; color: #3d3d3d; margin-bottom: 20px; line-height: 1.2; }
        .article-metadata { display: flex; flex-wrap: wrap; gap: 30px; align-items: center; margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #e8dcc8; }
        .meta-item { display: flex; align-items: center; gap: 10px; font-size: 14px; color: #6b6b6b; }
        .meta-label { font-weight: 600; color: #b8956a; }
        .article-actions { display: flex; gap: 15px; align-items: center; margin-bottom: 40px; flex-wrap: wrap; }
        .action-btn { display: flex; align-items: center; gap: 8px; padding: 12px 24px; border: 2px solid #b8956a; background-color: transparent; color: #b8956a; cursor: pointer; border-radius: 8px; font-size: 14px; font-weight: 500; transition: all 0.3s; text-decoration: none; }
        .action-btn:hover { background-color: #b8956a; color: white; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(184, 149, 106, 0.3); }
        .action-btn.active { background-color: #b8956a; color: white; }
        .action-btn.like-btn.active { background-color: #e74c3c; border-color: #e74c3c; }
        .action-btn.favorite-btn.active { background-color: #f39c12; border-color: #f39c12; }
        .article-content { font-size: 18px; line-height: 1.8; margin-bottom: 50px; color: #4d4d4d; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); }
        .article-content p { margin-bottom: 20px; }
        .comments-section { margin-top: 60px; padding-top: 40px; border-top: 2px solid #e8dcc8; }
        .comments-title { font-family: 'Cormorant Garamond', serif; font-size: 36px; font-weight: 600; color: #3d3d3d; margin-bottom: 30px; }
        .comments-list { margin-bottom: 40px; }
        .comment-item { background-color: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); border-left: 4px solid #b8956a; transition: transform 0.2s, box-shadow 0.2s; }
        .comment-item:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .comment-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .comment-author { font-weight: 600; color: #3d3d3d; font-size: 16px; }
        .comment-date { font-size: 13px; color: #999; }
        .comment-text { color: #4d4d4d; line-height: 1.7; margin-bottom: 12px; font-size: 15px; }
        .comment-actions { display: flex; align-items: center; gap: 0.75rem; margin-top: 0.5rem; font-size: 13px; }
        .comment-action-form { display: inline; }
        .comment-action { display: inline-flex; align-items: center; gap: 0.35rem; color: #b8956a; cursor: pointer; text-decoration: none; background: none; border: none; padding: 0; font-size: inherit; transition: color 0.2s; }
        .comment-action:hover { color: #8b6f47; }
        .comment-action--delete:hover { color: #c9302c; }
        .comment-action .icon-pencil, .comment-action .icon-trash { flex-shrink: 0; }
        .no-comments { text-align: center; padding: 60px 20px; color: #999; font-style: italic; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); }
        .comment-form-section { background-color: white; padding: 40px; border-radius: 12px; margin-top: 40px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); }
        .comment-form-title { font-family: 'Cormorant Garamond', serif; font-size: 28px; font-weight: 600; color: #3d3d3d; margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: 500; color: #3d3d3d; margin-bottom: 10px; font-size: 15px; }
        .form-control { width: 100%; padding: 15px; border: 2px solid #e8dcc8; border-radius: 8px; font-family: 'Outfit', sans-serif; font-size: 15px; color: #3d3d3d; transition: border-color 0.3s; resize: vertical; }
        .form-control:focus { outline: none; border-color: #b8956a; background-color: #faf8f6; }
        textarea.form-control { min-height: 120px; line-height: 1.6; }
        .form-submit { background-color: #b8956a; color: white; padding: 14px 35px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        .form-submit:hover { background-color: #8b6f47; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(184, 149, 106, 0.3); }
        .login-prompt { text-align: center; padding: 40px; background-color: #f5f1eb; border-radius: 8px; margin-top: 20px; }
        .login-prompt p { color: #6b6b6b; margin-bottom: 15px; font-size: 15px; }
        .login-prompt a { color: #b8956a; text-decoration: none; font-weight: 600; transition: color 0.3s; }
        .login-prompt a:hover { color: #8b6f47; text-decoration: underline; }
        .alert { padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .back-link { display: inline-flex; align-items: center; gap: 8px; color: #b8956a; text-decoration: none; font-weight: 500; transition: color 0.3s; margin-top: 30px; font-size: 15px; }
        .back-link:hover { color: #8b6f47; }
        @media (max-width: 768px) {
            .article-title { font-size: 32px; }
            .article-metadata { flex-direction: column; align-items: flex-start; gap: 15px; }
            .action-btn { flex: 1; justify-content: center; }
            .comment-form-section { padding: 25px; }
            .article-content { padding: 25px; font-size: 16px; }
        }
    </style>
{% endblock %}

{% block body %}
<div class="article-container">
    <div class="breadcrumb">
        <a href="{{ path('app_article_index') }}">Articles</a>
        <span>/</span>
        <span>{{ article.titre }}</span>
    </div>

    {% for message in app.flashes('success') %}<div class="alert alert-success">{{ message }}</div>{% endfor %}
    {% for message in app.flashes('error') %}<div class="alert alert-error">{{ message }}</div>{% endfor %}

    <div class="article-header">
        {% if article.image %}
            <img src="{{ asset('image/' ~ article.image) }}" alt="{{ article.titre }}" class="article-image">
        {% else %}
            <div class="article-image" style="background: linear-gradient(135deg, #c9a17a 0%, #a8935f 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">Pas d'image disponible</div>
        {% endif %}

        <h1 class="article-title">{{ article.titre }}</h1>

        <div class="article-metadata">
            <div class="meta-item"><span class="meta-label">Par:</span> <span>{% if article.artisan %}{{ article.artisan.prenom }} {{ article.artisan.nom }}{% else %}Non sp√©cifi√©{% endif %}</span></div>
            <div class="meta-item"><span class="meta-label">Date:</span> <span>{{ article.date ? article.date|date('d M Y') : 'Date non disponible' }}</span></div>
            <div class="meta-item"><span class="meta-label">Commentaires:</span> <span>{{ article.commentaires|length }}</span></div>
            {% if article.categorie %}<div class="meta-item"><span class="meta-label">Cat√©gorie:</span> <span>{{ article.categorie }}</span></div>{% endif %}
            {% if article.prix is not null and article.prix != '' %}<div class="meta-item"><span class="meta-label">Prix:</span> <span>{{ article.prix }} DT</span></div>{% endif %}
        </div>

        <div class="article-actions">
            {% if isClient %}
                <form method="POST" action="{{ path('app_article_like', {'id': article.id}) }}" style="display: inline;">
                    <input type="hidden" name="_token" value="{{ csrf_token('like' ~ article.id) }}">
                    <button type="submit" class="action-btn like-btn" title="Aimer cet article">‚ù§Ô∏è <span>Aimer</span></button>
                </form>
                <form method="POST" action="{{ path('app_article_favorite', {'id': article.id}) }}" style="display: inline;">
                    <input type="hidden" name="_token" value="{{ csrf_token('favorite' ~ article.id) }}">
                    <button type="submit" class="action-btn favorite-btn" title="Ajouter aux favoris">‚≠ê <span>Favoris</span></button>
                </form>
            {% endif %}
            {% if user and (isAdmin or (isArtisan and article.artisan and article.artisan.id == user.id)) %}
                <a href="{{ path('app_article_edit', {'id': article.id}) }}" class="action-btn" title="Modifier l'article">‚úèÔ∏è Modifier</a>
                <form method="POST" action="{{ path('app_article_delete', {'id': article.id}) }}" style="display: inline;" onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cet article ?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ article.id) }}">
                    <button type="submit" class="action-btn" style="border-color: #c9302c; color: #c9302c;" title="Supprimer l'article">üóëÔ∏è Supprimer</button>
                </form>
            {% endif %}
        </div>
    </div>

    <div class="article-content">
        {{ article.contenu|nl2br }}
    </div>

    <div class="comments-section">
        <h2 class="comments-title">Commentaires ({{ article.commentaires|length }})</h2>

        {% if article.commentaires|length > 0 %}
            <div class="comments-list">
                {% for comment in article.commentaires %}
                    <div class="comment-item">
                        <div class="comment-header">
                            <span class="comment-author">{% if comment.user %}{{ comment.user.prenom }} {{ comment.user.nom }}{% else %}Anonyme{% endif %}</span>
                            <span class="comment-date">{{ comment.datepub ? comment.datepub|date('d M Y √† H:i') : 'Date non disponible' }}</span>
                        </div>
                        <div class="comment-text">{{ comment.contenu|nl2br }}</div>
                        {% if isClient and user and comment.user and comment.user.id == user.id %}
                        <div class="comment-actions">
                            <a href="{{ path('app_commentaire_modifier', { commentaire: comment.id }) }}" class="comment-action comment-action--edit" title="Modifier le commentaire">
                                <svg class="icon-pencil" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                Modifier
                            </a>
                            <form method="post" action="{{ path('app_commentaire_supprimer', { commentaire: comment.id }) }}" class="comment-action-form" onsubmit="return confirm('Supprimer ce commentaire ?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('commentaire_supprimer' ~ comment.id) }}">
                                <button type="submit" class="comment-action comment-action--delete" title="Supprimer le commentaire">
                                    <svg class="icon-trash" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                                    Supprimer
                                </button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-comments"><p>Aucun commentaire pour le moment. Soyez le premier √† commenter !</p></div>
        {% endif %}

        <div class="comment-form-section">
            <h3 class="comment-form-title">Ajouter un commentaire</h3>
            {% if isClient %}
                <p style="margin-bottom: 15px; color: #6b6b6b; font-size: 14px;">Connect√© en tant que: <strong>{{ user.prenom }} {{ user.nom }}</strong> | <a href="{{ path('app_logout') }}" style="color: #b8956a; text-decoration: none;">D√©connexion</a></p>
                {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
                    <div class="form-group">{{ form_label(form.contenu) }}{{ form_widget(form.contenu, {'attr': {'class': 'form-control'}}) }}{{ form_errors(form.contenu) }}</div>
                    <button type="submit" class="form-submit">Publier le commentaire</button>
                {{ form_end(form) }}
            {% else %}
                <div class="login-prompt">
                    <p><strong>Vous devez √™tre connect√© en tant que client pour commenter.</strong></p>
                    <p>Connectez-vous pour partager votre avis sur cet article.</p>
                    <p style="margin-top: 15px;"><a href="{{ path('app_login') }}" style="background-color: #b8956a; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; display: inline-block; font-weight: 600;">Se connecter</a></p>
                </div>
            {% endif %}
        </div>
    </div>

    <a href="{{ path('app_article_index') }}" class="back-link">‚Üê Retour √† la liste des articles</a>
</div>
{% endblock %}

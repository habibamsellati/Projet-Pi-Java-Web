{% for label, messages in app.flashes %}
  {% for message in messages %}
    <div class="flash {{ label }}">{{ message }}</div>
  {% endfor %}
{% endfor %}

{% set _turnstileSiteKey = turnstile_site_key|default('') %}

<h2>Creer un compte</h2>
<p class="form-description">Rejoignez AfkArt et decouvrez l'art qui donne une seconde vie</p>

<form method="post" action="{{ path('app_register') }}">
  <div class="form-group">
    <label for="nom_modal">Nom</label>
    <input type="text" id="nom_modal" name="nom" required />
  </div>

  <div class="form-group">
    <label for="prenom_modal">Prenom</label>
    <input type="text" id="prenom_modal" name="prenom" required />
  </div>

  <div class="form-group">
    <label for="email_modal">Email</label>
    <input type="text" id="email_modal" name="email" required />
    <div class="email-hint" data-email-hint style="margin-top: 0.35rem; color: #991b1b; font-size: 0.85rem;">L'email doit contenir @</div>
  </div>

  <div class="form-group">
    <label for="motdepasse_modal">Mot de passe</label>
    <input type="password" id="motdepasse_modal" name="motdepasse" required />
  </div>

  <div class="form-group">
    <label for="sexe_modal">Sexe</label>
    <select id="sexe_modal" name="sexe" required>
      <option value="HOMME">Homme</option>
      <option value="FEMME">Femme</option>
      <option value="AUTRE">Autre</option>
    </select>
  </div>

  <div class="form-group">
    <label for="role_modal">Je suis</label>
    <select id="role_modal" name="role" required>
      <option value="CLIENT">Un Client</option>
      <option value="ARTISANT">Un Artisan</option>
      <option value="ADMIN">Un Administrateur</option>
      <option value="LIVREUR">Un Livreur</option>
    </select>
  </div>

  {% if _turnstileSiteKey is not empty %}
    <div class="form-group" style="display:flex; justify-content:center;">
      <div class="cf-turnstile" data-sitekey="{{ _turnstileSiteKey }}"></div>
    </div>
  {% endif %}

  <button type="submit" class="btn btn-primary">S'inscrire</button>
</form>
{% if _turnstileSiteKey is not empty %}
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var emailInput = document.getElementById('email_modal');
    var hint = document.querySelector('[data-email-hint]');
    if (!emailInput || !hint) return;

    function updateHint() {
      var ok = emailInput.value.indexOf('@') !== -1;
      if (ok) {
        hint.textContent = 'Email valide';
        hint.style.color = '#166534';
      } else {
        hint.textContent = "L'email doit contenir @";
        hint.style.color = '#991b1b';
      }
    }

    emailInput.addEventListener('input', updateHint);
    updateHint();
  });
</script>

<div class="form-footer">
  Vous avez deja un compte? <a href="#" class="switch-auth" data-target="login">Se connecter</a>
</div>

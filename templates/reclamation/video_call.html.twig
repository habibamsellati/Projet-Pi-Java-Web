{% extends 'base.html.front.twig' %}

{% block title %}Visioconf√©rence - R√©clamation #{{ reclamation.id }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .video-call-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }
        .page-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            color: #8b5e4a;
            margin-bottom: 1.5rem;
        }
        .video-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        .video-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0e0e0;
        }
        .video-info h2 {
            font-size: 1.3rem;
            color: #2d7a4f;
            margin: 0 0 0.3rem 0;
        }
        .video-info p {
            font-size: 0.9rem;
            color: #666;
            margin: 0;
        }
        .exit-button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .exit-button:hover {
            background: #c82333;
        }
        .video-wrapper {
            width: 100%;
            height: 600px;
            border-radius: 8px;
            overflow: hidden;
            background: #1a1a1a;
        }
        #jitsi-meet {
            width: 100%;
            height: 100%;
        }
        .back-link {
            display: inline-block;
            color: #8b5e4a;
            text-decoration: none;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
{% endblock %}

{% block body %}
<div class="video-call-container">
    <a href="{{ path('app_reclamation_show', {'id': reclamation.id}) }}" class="back-link">‚Üê Retour √† la r√©clamation</a>
    
    <h1 class="page-title">Visioconf√©rence avec l'administrateur</h1>

    <div class="video-card">
        <div class="video-header">
            <div class="video-info">
                <h2>üìπ R√©clamation: {{ reclamation.titre }}</h2>
                <p>Discutez en direct avec un administrateur pour r√©soudre votre r√©clamation</p>
            </div>
            <button class="exit-button" onclick="exitCall()">‚úï Quitter l'appel</button>
        </div>

        <div class="video-wrapper">
            <div id="jitsi-meet"></div>
        </div>
    </div>
</div>

<script src='https://meet.jit.si/external_api.js'></script>
<script>
    const domain = 'meet.jit.si';
    const options = {
        roomName: '{{ roomId }}',
        width: '100%',
        height: '100%',
        parentNode: document.querySelector('#jitsi-meet'),
        userInfo: {
            displayName: '{{ displayName }}'
        },
        configOverwrite: {
            startWithAudioMuted: false,
            startWithVideoMuted: false,
            prejoinPageEnabled: false,
            disableDeepLinking: true
        },
        interfaceConfigOverwrite: {
            SHOW_JITSI_WATERMARK: false,
            SHOW_WATERMARK_FOR_GUESTS: false,
            SHOW_BRAND_WATERMARK: false,
            BRAND_WATERMARK_LINK: '',
            DEFAULT_BACKGROUND: '#1a1a1a',
            DISABLE_JOIN_LEAVE_NOTIFICATIONS: false,
            TOOLBAR_BUTTONS: [
                'microphone', 'camera', 'closedcaptions', 'desktop', 'fullscreen',
                'fodeviceselection', 'hangup', 'profile', 'chat', 'recording',
                'livestreaming', 'etherpad', 'sharedvideo', 'settings', 'raisehand',
                'videoquality', 'filmstrip', 'feedback', 'stats', 'shortcuts',
                'tileview', 'videobackgroundblur', 'download', 'help', 'mute-everyone'
            ]
        }
    };

    const api = new JitsiMeetExternalAPI(domain, options);

    // Handle when user leaves the call
    api.addEventListener('readyToClose', () => {
        exitCall();
    });

    function exitCall() {
        if (confirm('√ätes-vous s√ªr de vouloir quitter la visioconf√©rence ?')) {
            window.location.href = '{{ path('app_reclamation_show', {'id': reclamation.id}) }}';
        }
    }
</script>
{% endblock %}
